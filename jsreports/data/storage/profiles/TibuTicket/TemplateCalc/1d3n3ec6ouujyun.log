{"type":"operationStart","subtype":"profile","data":{"_id":"hIh7xsBCn8K29k8M","timestamp":"2024-02-22T11:32:31.702Z","state":"queued","mode":"standard","creationDate":"2024-02-22T11:32:31.703Z","modificationDate":"2024-02-22T11:32:31.703Z","shortid":"E_KF-bL","$entitySet":"profiles"},"doDiffs":false,"timestamp":1708601551702,"id":"la80veib0tnvf04","previousOperationId":null,"operationId":"2vhkbi4qu6jvcso"}
{"type":"log","level":"info","message":"Render request 4 queued for execution and waiting for available worker","previousOperationId":"2vhkbi4qu6jvcso","timestamp":1708601551702,"id":"p4d85mmsrrqdlhu"}
{"type":"operationStart","subtype":"render","name":"TemplateCalc","previousOperationId":"2vhkbi4qu6jvcso","timestamp":1708601551708,"id":"z0he2c59ki5hm1z","previousEventId":"la80veib0tnvf04","operationId":"b966jdov5hcnepe"}
{"type":"log","timestamp":1708601551708,"level":"info","message":"Starting rendering request 4","meta":{"rootId":"1d3n3ec6ouujyun","id":"1d3n3ec6ouujyun"},"id":"dabyvxjsj3jyilv","previousOperationId":"b966jdov5hcnepe"}
{"type":"log","timestamp":1708601551709,"level":"info","message":"Rendering template { name: TemplateCalc, recipe: chrome-pdf, engine: handlebars, preview: false }","meta":{"rootId":"1d3n3ec6ouujyun","id":"1d3n3ec6ouujyun"},"id":"cd8ms1v63zl8fds","previousOperationId":"b966jdov5hcnepe"}
{"type":"log","timestamp":1708601551710,"level":"debug","message":"Inline data specified.","meta":{"rootId":"1d3n3ec6ouujyun","id":"1d3n3ec6ouujyun"},"id":"ibjjq7u5sajbryd","previousOperationId":"b966jdov5hcnepe"}
{"type":"log","timestamp":1708601551713,"level":"debug","message":"Executing script list-data (beforeRender)","meta":{"rootId":"1d3n3ec6ouujyun","id":"1d3n3ec6ouujyun"},"id":"vxtw2p0ap7t67ji","previousOperationId":"b966jdov5hcnepe"}
{"type":"log","timestamp":1708601551901,"level":"warn","message":"Error when processing render request 4\n(because) error when evaluating custom script /TibuTicket/list-data\nUnable to find module nodemailer\nThe require calls:\nrequire('nodemailer')\nrequire('/home/ruby/workspace/tibuTicket/jsreports/nodemailer')\n\n\n(sandbox.js line 1:169)\n\n> 1 | const nodemailer = require('nodemailer');\n    |                                          ^\n  2 | const http = require('http');\n  3 |\n  4 | async function fetchlists() {\n\n\nError: Unable to find module nodemailer\nThe require calls:\nrequire('nodemailer')\nrequire('/home/ruby/workspace/tibuTicket/jsreports/nodemailer')\n\n    at doRequire (/home/ruby/workspace/tibuTicket/jsreports/node_modules/@jsreport/jsreport-core/lib/worker/sandbox/requireSandbox.js:89:11)\n    at sandboxRequire (/home/ruby/workspace/tibuTicket/jsreports/node_modules/@jsreport/jsreport-core/lib/worker/sandbox/requireSandbox.js:44:14)\n    at require (/home/ruby/workspace/tibuTicket/jsreports/node_modules/@jsreport/jsreport-core/lib/worker/sandbox/createSandbox.js:89:30)\n    at sandbox.js:1:169","meta":{"rootId":"1d3n3ec6ouujyun","id":"1d3n3ec6ouujyun"},"id":"53j5osf3my4se1r","previousOperationId":"b966jdov5hcnepe"}
{"type":"log","timestamp":1708601551902,"level":"warn","message":"Rendering request 4 finished with error in 200 ms","meta":{"rootId":"1d3n3ec6ouujyun","id":"1d3n3ec6ouujyun"},"id":"b694h54f346ye4k","previousOperationId":"b966jdov5hcnepe"}
{"type":"error","timestamp":1708601551903,"statusCode":400,"weak":true,"decoratedSuffix":"\n\n(sandbox.js line 1:169)\n\n> 1 | const nodemailer = require('nodemailer');\n    |                                          ^\n  2 | const http = require('http');\n  3 |\n  4 | async function fetchlists() {\n\n","entity":{"shortid":"6v8QPG_9N3","name":"list-data","content":"const nodemailer = require('nodemailer');\nconst http = require('http');\n\nasync function fetchlists() {\n    const options = {\n        hostname: 'localhost',\n        port: 4000,\n        path: '/api/v1/lists',\n        method: 'GET',\n    };\n\n    return new Promise((resolve, reject) => {\n        const req = http.request(options, (result) => {\n            let str = '';\n            result.on('data', (b) => str += b);\n            result.on('error', reject);\n            result.on('end', () => resolve(JSON.parse(str)));\n        });\n\n        req.end();\n    });\n}\n\nasync function fetchusers() {\n    const options = {\n        hostname: 'localhost',\n        port: 4000,\n        path: '/api/v1/users/users',\n        method: 'GET',\n    };\n\n    return new Promise((resolve, reject) => {\n        const req = http.request(options, (result) => {\n            let str = '';\n            result.on('data', (b) => str += b);\n            result.on('error', reject);\n            result.on('end', () => resolve(JSON.parse(str)));\n        });\n\n        req.end();\n    });\n}\n\nasync function beforeRender(req, res) {\n    try {\n        req.data.lists = await fetchlists();\n        console.log(req.data.lists);\n    } catch (error) {\n        console.error('Error fetching lists:', error);\n    }\n\n    try {\n        req.data.users = await fetchusers();\n        console.log(req.data.users);\n    } catch (error) {\n        console.error('Error fetching users:', error);\n    }\n}\n\nfunction afterRender(req, res) {\n  const transport = nodemailer.createTransport({\n    host: 'sandbox.smtp.mailtrap.io',\n    port: 2525,\n    auth: {\n      user: '79e32bd0362e26',\n      pass: '5cb77dc70b96ea',\n    },\n  });\n\n  const mailOptions = {\n    from: 'sender@example.com',\n    to: req.data.email,\n    subject: 'Informe generado',\n    text: 'Adjunto encontrarás el informe en formato PDF.',\n    attachments: [\n      {\n        filename: 'informe.pdf',\n        content: res.content,\n        encoding: 'base64',\n        },\n    ],\n  };\n  transport.sendMail(mailOptions, (error, info) => {\n    if (error) {\n      console.error('Error al enviar el correo electrónico:', error);\n    } else {\n      console.log('Correo electrónico enviado con éxito:', info.response);\n    }\n  });\n}\n"},"property":"content","logged":true,"previousOperationId":"b966jdov5hcnepe","id":"6n6bn59srrooboo","stack":"Error: Unable to find module nodemailer\nThe require calls:\nrequire('nodemailer')\nrequire('/home/ruby/workspace/tibuTicket/jsreports/nodemailer')\n\n    at doRequire (/home/ruby/workspace/tibuTicket/jsreports/node_modules/@jsreport/jsreport-core/lib/worker/sandbox/requireSandbox.js:89:11)\n    at sandboxRequire (/home/ruby/workspace/tibuTicket/jsreports/node_modules/@jsreport/jsreport-core/lib/worker/sandbox/requireSandbox.js:44:14)\n    at require (/home/ruby/workspace/tibuTicket/jsreports/node_modules/@jsreport/jsreport-core/lib/worker/sandbox/createSandbox.js:89:30)\n    at sandbox.js:1:169","message":"Error when evaluating custom script /TibuTicket/list-data\nUnable to find module nodemailer\nThe require calls:\nrequire('nodemailer')\nrequire('/home/ruby/workspace/tibuTicket/jsreports/nodemailer')\n\n\n(sandbox.js line 1:169)\n\n> 1 | const nodemailer = require('nodemailer');\n    |                                          ^\n  2 | const http = require('http');\n  3 |\n  4 | async function fetchlists() {\n\n"}
